<!DOCTYPE html>
<html lang="en">
<head>
  <title>Manage Users | NexusResQ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="manage-users.css">
</head>
<body>
  <div class="users-container">
    <h2>View/Modify Users</h2>
    <div id="user-list" class="user-grid-container"></div>

    <h3>New User</h3>
    <form id="add-user-form">
      <input type="text" id="new-username" placeholder="Username" required>
      <input type="password" id="new-password" placeholder="Password" required>
      <select id="new-role">
        <option value="user">User</option>
        <option value="admin">Admin</option>
      </select>
      <button type="submit">Add User</button>
    </form>
    <div id="add-user-message"></div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabaseUrl = 'https://vainwbdealnttojooghwi.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'; // your real anon key
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // 1. List users
    async function loadUsers() {
      const { data, error } = await supabase.from('users').select('*');
      if (error || !data) {
        document.getElementById('user-list').innerText = 'Failed to load users.';
        return;
      }
      let html = '<table><tr><th>Username</th><th>Role</th><th>Actions</th></tr>';
      for (const user of data) {
        html += `<tr>
          <td>${user.username}</td>
          <td>${user.role}</td>
          <td>
            <button onclick="deleteUser('${user.username}')">Delete</button>
          </td>
        </tr>`;
      }
      html += '</table>';
      document.getElementById('user-list').innerHTML = html;
    }

    // 2. Add user
    document.getElementById('add-user-form').onsubmit = async function(e) {
      e.preventDefault();
      const username = document.getElementById('new-username').value.trim();
      const password = document.getElementById('new-password').value.trim();
      const role = document.getElementById('new-role').value;
      const { error } = await supabase.from('users').insert([{ username, password, role }]);
      if (error) {
        document.getElementById('add-user-message').innerText = "Error adding user.";
      } else {
        document.getElementById('add-user-message').innerText = "User added!";
        loadUsers();
      }
    }

    // 3. Delete user
    window.deleteUser = async function(username) {
      if (!confirm(`Delete user: ${username}?`)) return;
      const { error } = await supabase.from('users').delete().eq('username', username);
      if (error) alert('Failed to delete user.');
      loadUsers();
    }

    // Initial load
    loadUsers();
  </script>
</body>
</html>
